{"version":3,"sources":["index.tsx"],"names":["map","Streamlit","events","addEventListener","RENDER_EVENT","event","data","detail","fig","args","height","width","debouncedUpdateComponentValue","debounce","updateComponentValue","global_data","__GLOBAL_DATA__","bounds","getBounds","setComponentValue","last_clicked","lat_lng_clicked","last_object_clicked","all_drawings","last_active_drawing","onLayerClick","e","latlng","layer","toGeoJSON","target","_layers","details","layers","key","push","map_div","document","getElementById","map_div2","style","render_script","createElement","replaced","innerHTML","body","appendChild","on","setFrameHeight","setComponentReady"],"mappings":"oHAAA,yBAGIA,EAAW,KAkIfC,IAAUC,OAAOC,iBAAiBF,IAAUG,cAhH5C,SAAkBC,GAEhB,IAAMC,EAAQD,EAAkCE,OAG1CC,EAAcF,EAAKG,KAAL,IACdC,EAAiBJ,EAAKG,KAAL,OACjBE,EAAgBL,EAAKG,KAAL,MAQlBG,EAAgCC,YAASC,EAAsB,KAEnE,SAASA,IACP,IAAMC,EAAcC,gBAEhBC,EADMF,EAAYf,IACLkB,YACjBjB,IAAUkB,kBAAkB,CAC1BC,aAAcL,EAAYM,gBAC1BC,oBAAqBP,EAAYO,oBACjCC,aAAcR,EAAYQ,aAC1BC,oBAAqBT,EAAYS,oBACjCP,OAAQA,IAYZ,SAASQ,EAAaC,GACpB,IAAMX,EAAcC,gBAKpB,GAJAD,EAAYO,oBAAsBI,EAAEC,OAChCD,EAAEE,OAASF,EAAEE,MAAMC,YACrBd,EAAYS,oBAAsBE,EAAEE,MAAMC,aAExCH,EAAEI,OAAOC,QAAS,CACpB,IAAIC,EAAU,GACVC,EAASP,EAAEI,OAAOC,QACtB,IAAK,IAAIG,KAAOD,EAAQ,CACtB,IAAIL,EAAQK,EAAOC,GACfN,EAAMC,WACRG,EAAQG,KAAKP,EAAMC,aAGvBd,EAAYQ,aAAeS,EAE7BpB,IAGF,GAAW,MAAPZ,EACF,IACEA,EAAMgB,gBAAgBhB,IACtB,MAAO0B,GAGP,IAAMU,EAAUC,SAASC,eAAe,WAClCC,EAAWF,SAASC,eAAe,YAKzC,GAJIC,IACFA,EAASC,MAAM9B,OAAf,UAA2BA,EAA3B,MACA6B,EAASC,MAAM7B,MAAf,UAA0BA,EAA1B,OAEEyB,EAAS,CACXA,EAAQI,MAAM9B,OAAd,UAA0BA,EAA1B,MACA0B,EAAQI,MAAM7B,MAAd,UAAyBA,EAAzB,MAEA,IAAM8B,EAAgBJ,SAASK,cAAc,UAazCC,EAAWnC,EATI,+QAUnBiC,EAAcG,UAAYD,EAC1BN,SAASQ,KAAKC,YAAYL,GAE1B,IACIzC,EADgBgB,gBACEhB,IAItB,IAAK,IAAIkC,KAFTlC,EAAI+C,GAAG,SArFb,SAAoBrB,GACEV,gBACRK,gBAAkBK,EAAEC,OAChCf,OAmFIZ,EAAI+C,GAAG,WAjEb,SAAmBrB,GACjBd,OAiEoBZ,EAAI+B,QAAS,CACf/B,EAAI+B,QAAQG,GAClBa,GAAG,QAAStB,GAGpBzB,EAAI+C,GAAG,gBAnEb,SAAgBrB,GACd,OAAOD,EAAaC,MAqEhBzB,IAAU+C,iBACVlC,SAWRb,IAAUgD,oBAIVhD,IAAU+C,mB","file":"static/js/main.f23388f1.chunk.js","sourcesContent":["import { Streamlit, RenderData } from \"streamlit-component-lib\"\nimport { debounce } from \"underscore\";\n\nlet map: any = null;\n\ntype GlobalData = {\n  map: any;\n  lat_lng_clicked: any;\n  last_object_clicked: any;\n  last_active_drawing: any,\n  all_drawings: any,\n  bounds: any;\n};\n\ndeclare var __GLOBAL_DATA__: GlobalData;\n\n/**\n * The component's render function. This will be called immediately after\n * the component is initially loaded, and then again every time the\n * component gets new data from Python.\n */\nfunction onRender(event: Event): void {\n  // Get the RenderData from the event\n  const data = (event as CustomEvent<RenderData>).detail\n\n  //console.log(data.args)\n  const fig: string = data.args[\"fig\"];\n  const height: number = data.args[\"height\"];\n  const width: number = data.args[\"width\"];\n\n  function onMapClick(e: any) {\n    const global_data = __GLOBAL_DATA__;\n    global_data.lat_lng_clicked = e.latlng;\n    debouncedUpdateComponentValue()\n  }\n\n  let debouncedUpdateComponentValue = debounce(updateComponentValue, 250)\n\n  function updateComponentValue() {\n    const global_data = __GLOBAL_DATA__;\n    let map = global_data.map;\n    let bounds = map.getBounds();\n    Streamlit.setComponentValue({\n      last_clicked: global_data.lat_lng_clicked,\n      last_object_clicked: global_data.last_object_clicked,\n      all_drawings: global_data.all_drawings,\n      last_active_drawing: global_data.last_active_drawing,\n      bounds: bounds,\n    })\n  }\n\n  function onMapMove(e: any) {\n    debouncedUpdateComponentValue()\n  }\n\n  function onDraw(e: any) {\n    return onLayerClick(e);\n  }\n\n  function onLayerClick(e: any) {\n    const global_data = __GLOBAL_DATA__;\n    global_data.last_object_clicked = e.latlng;\n    if (e.layer && e.layer.toGeoJSON) {\n      global_data.last_active_drawing = e.layer.toGeoJSON();\n    }\n    if (e.target._layers) {\n      let details = []\n      let layers = e.target._layers;\n      for (let key in layers) {\n        let layer = layers[key];\n        if (layer.toGeoJSON) {\n          details.push(layer.toGeoJSON());\n        }\n      }\n      global_data.all_drawings = details;\n    }\n    debouncedUpdateComponentValue()\n  }\n\n  if (map == null) {\n    try {\n      map = __GLOBAL_DATA__.map;\n    } catch (e) {\n      // Only run this if the map hasn't already been created (and thus the global\n      //data hasn't been initialized)\n      const map_div = document.getElementById(\"map_div\");\n      const map_div2 = document.getElementById(\"map_div2\");\n      if (map_div2) {\n        map_div2.style.height = `${height}px`\n        map_div2.style.width = `${width}px`\n      }\n      if (map_div) {\n        map_div.style.height = `${height}px`\n        map_div.style.width = `${width}px`\n\n        const render_script = document.createElement(\"script\")\n        // HACK -- update the folium-generated JS to add, most importantly,\n        // the map to this global variable so that it can be used elsewhere\n        // in the script.\n        let set_global_data = `\n          window.__GLOBAL_DATA__ = {\n            map: map_div,\n            bounds: map_div.getBounds(),\n            lat_lng_clicked: null,\n            last_object_clicked: null,\n            all_drawings: null,\n            last_active_drawing: null,\n        };`;\n        let replaced = fig + set_global_data;\n        render_script.innerHTML = replaced;\n        document.body.appendChild(render_script);\n\n        const global_data = __GLOBAL_DATA__;\n        let map = global_data.map;\n\n        map.on('click', onMapClick);\n        map.on('moveend', onMapMove);\n        for (let key in map._layers) {\n          let layer = map._layers[key];\n          layer.on(\"click\", onLayerClick)\n        }\n        debugger;\n        map.on('draw:created', onDraw);\n        //map.on('draw:edited', onDraw);\n\n        Streamlit.setFrameHeight()\n        updateComponentValue();\n      }\n    }\n  }\n}\n\n// Attach our `onRender` handler to Streamlit's render event.\nStreamlit.events.addEventListener(Streamlit.RENDER_EVENT, onRender)\n\n// Tell Streamlit we're ready to start receiving data. We won't get our\n// first RENDER_EVENT until we call this function.\nStreamlit.setComponentReady()\n\n// Finally, tell Streamlit to update our initial height. We omit the\n// `height` parameter here to have it default to our scrollHeight.\nStreamlit.setFrameHeight()"],"sourceRoot":""}