import{u as H,G as q,v as n,P as N,O as _e,o as i,B,L as de,ay as Q,r as F,c as v,d as s,a as r,w as d,A as e,ax as pe,I as X,ak as Y,az as fe,y,M as h,aA as me,aB as ve,aC as he,aD as ge,U as be,aw as we,W as ye,av as xe,x,al as ke,F as Re,p as Ie,b as Te}from"./vendor.d790ce30.js";import{A as k,E as I,_ as Fe,s as Z,S as $e,f as ee,R as Se,t as Le}from"./index.ca42c5fd.js";import{T as Ce}from"./Timeline.c3f5abef.js";import{R as qe,M as Ne}from"./MiniRadar.41d387fe.js";const Be=H({props:{id:{type:String,required:!0}},setup(p){const g=p,b=q(new qe),f=n(()=>({id:g.id})),u={radar:k.query({endpoint:I.radar,body:f,options:{pollInterval:5e3}})};return N(()=>{var a;return(a=u.radar.response)==null?void 0:a.value},a=>{a&&b.value.items(a)}),_e(()=>{b.value.id("id").dependencies("upstream_dependencies").items([])}),(a,D)=>(i(),B(Ne,{id:p.id,radar:b.value,"hide-viewport":"","disable-interactions":""},null,8,["id","radar"]))}});const De={class:"flow-run-logs-tabs-content"},je={class:"flow-run-logs-tabs-content__header"},Ee=h(" Copy Logs "),Ve={class:"flow-run-logs-tab-content__table"},Ae=me('<div class="flow-run-logs-tab-content__table-header"><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--level"> Level </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--time"> Time </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--message"> Message </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column-run"> Run name </span></div>',1),Me={class:"flow-run_logs-tab-content__empty"},Pe=h(" No logs to show. "),Ue=h(" Try clearing your filter "),He={key:0,class:"flow-run-logs-tabs-content__loading"},Ge=H({props:{flowRunId:{type:String,required:!0},running:{type:Boolean}},setup(p){const g=p,b=q(),f=[{label:"Critical only",value:50},{label:"Error and above",value:40},{label:"Warning and above",value:30},{label:"Info and above",value:20},{label:"Debug and above",value:10},{label:"All log levels",value:0}],u=q(0),a=n(()=>({logs:{flow_run_id:{any_:[g.flowRunId]},level:{ge_:u.value}}})),D={interval:g.running?5e3:void 0},c=de(Q.filter.bind(Q),[a],D),j=n(()=>{var o;return(o=c.response.value)!=null?o:[]}),$=n(()=>{var o;return(o=c.loading.value)!=null?o:!0}),S=()=>{u.value=0},V=()=>{if(!b.value)return;const o=b.value,w=o.scrollTop>0,T=o.scrollTop+o.offsetHeight===o.scrollHeight;w&&T&&ve(()=>{o.scrollTop=o.scrollHeight})},A=()=>j.value.map(o=>{const w=he(o.level),T=ge(o.timestamp);return`${w}	${T}	${o.message}`}).join(`
`);return N(()=>g.running,()=>c.unsubscribe()),N(()=>c.response.value,()=>V()),(o,w)=>{const T=F("m-select"),l=F("m-button"),M=F("m-loader");return i(),v("div",De,[s("div",je,[r(T,{modelValue:u.value,"onUpdate:modelValue":w[0]||(w[0]=R=>u.value=R),options:f,class:"flow-run-logs-tabs-content__filter"},null,8,["modelValue"]),r(e(pe),{text:"",value:A,class:"flow-run-logs__copy",toast:"Logs copied to clipboard"},{default:d(()=>[Ee]),_:1})]),s("div",Ve,[Ae,s("div",{ref:(R,L)=>{L.logsRef=R,b.value=R},class:"flow-run-logs-tab-content__logs"},[r(e(fe),{logs:e(j)},{empty:d(()=>[s("p",Me,[Pe,X(r(l,{class:"ml-2",onClick:S},{default:d(()=>[Ue]),_:1},512),[[Y,u.value]])])]),_:1},8,["logs"]),p.running||e($)?(i(),v("div",He,[r(M,{loading:!0,class:"flow-run-logs-tabs-content__loader"}),X(s("span",null,"Run in progress...",512),[[Y,p.running]])])):y("",!0)],512)])])}}});const E=p=>(Ie("data-v-3348cf19"),p=p(),Te(),p),We={class:"main-grid"},Oe={class:"d-flex align-center justify-space-between py-1 px-2"},ze={class:"d-inline-flex flex-column"},Je={class:"flex-grow-0 flex-shrink-1"},Ke={class:"d-inline-flex align-center text-truncate"},Qe={class:"caption font--primary font-weight-semibold text--grey-40 d-flex text-truncate"},Xe={key:0},Ye=h(" Started: "),Ze={class:"text--grey-80 mr-1 ml--half"},et={key:1},tt=h(" Ended: "),st={class:"text--grey-80 mr-1 ml--half"},nt={class:"caption font--primary font-weight-semibold text--grey-40 mt-1 d-flex text-truncate"},ot={key:0},at=h(" Deployment: "),lt={class:"text--grey-80 mr-1 ml--half"},rt={key:1},ut=h(" Parent: "),it={class:"text--grey-80"},ct=h(" /"),_t={key:2},dt=h(" Results: "),pt={class:"text--grey-80 mr-1 ml--half"},ft={key:3},mt=h(" Flow version: "),vt={class:"text--grey-80 mr-1 ml--half"},ht={class:"font--secondary"},gt={class:"d-flex align-center justify-space-between py-1 px-2"},bt=E(()=>s("div",{class:"subheader"},"Timeline",-1)),wt={class:"timeline-content pb-2 px-2 d-flex flex-grow-1"},yt={class:"d-flex align-center justify-space-between py-1 px-2"},xt=E(()=>s("div",{class:"subheader"},"Radar",-1)),kt={class:"radar-content pb-2 px-2 d-flex flex-grow-1"},Rt={key:0,class:"font--secondary caption my-2",style:{"min-height":"17px"}},It={class:"results-section d-flex flex-column align-stretch justify-stretch"},Tt={class:"text-center my-8",key:"no-results"},Ft=E(()=>s("h2",null," No Results Found ",-1)),$t=[Ft],St=E(()=>s("hr",{class:"results-hr mt-3"},null,-1)),Lt=H({async setup(p){let g,b;const f=be(),u=q("logs"),a=q(f==null?void 0:f.params.id),D=n(()=>({id:a.value})),c=([g,b]=we(()=>k.query({endpoint:I.flow_run,body:D,options:{pollInterval:5e3}}).fetch()),g=await g,b(),g),j=n(()=>c.response.value.flow_id),$=n(()=>c.response.value.parent_task_run_id),S=n(()=>c.response.value.deployment_id),V=n(()=>({id:j.value})),A=n(()=>({id:S.value})),o=n(()=>({task_runs:{id:{any_:[$.value]}}})),w=n(()=>({flow_runs:{id:{any_:[a.value]}}})),T=n(()=>({flow_runs:{id:{any_:[a.value]}},task_runs:{subflow_runs:{exists_:!0}}})),l={flow:k.query({endpoint:I.flow,body:V}),deployment:k.query({endpoint:I.deployment,body:A,options:{paused:!S.value}}),parent_flow:k.query({endpoint:I.flows,body:o,options:{paused:!$.value}}),parent_flow_run:k.query({endpoint:I.flow_runs,body:o,options:{paused:!$.value}}),task_runs_count:k.query({endpoint:I.task_runs_count,body:w,options:{pollInterval:1e4}}),task_runs:k.query({endpoint:I.task_runs,body:w,options:{pollInterval:1e4}}),sub_flow_runs_count:k.query({endpoint:I.task_runs_count,body:T,options:{pollInterval:1e4}})},M={task_runs:"task_runs_count",sub_flow_runs:"sub_flow_runs_count",logs:""},R=n(()=>{var t;return u.value&&((t=l[M[u.value]])==null?void 0:t.response)||0}),L=n(()=>{var t;return((t=l.deployment.response)==null?void 0:t.value)||{}}),G=n(()=>{var t,m;return((m=(t=l.parent_flow.response)==null?void 0:t.value)==null?void 0:m[0])||{}}),W=n(()=>{var t,m;return((m=(t=l.parent_flow_run.response)==null?void 0:t.value)==null?void 0:m[0])||{}}),O=n(()=>{var t,m;return(m=(t=L.value)==null?void 0:t.flow_data)==null?void 0:m.blob}),_=n(()=>{var t;return((t=c.response)==null?void 0:t.value)||{}}),te=n(()=>_.value.end_time),C=n(()=>{var t;return(t=_.value)==null?void 0:t.state}),se=n(()=>C.value.type=="RUNNING"),ne=n(()=>{var t;return((t=_.value)==null?void 0:t.tags)||[]}),oe=n(()=>{var t;return((t=l.task_runs_count.response)==null?void 0:t.value)||0}),ae=n(()=>{var t;return((t=l.sub_flow_runs_count.response)==null?void 0:t.value)||0}),z=n(()=>{var t;return((t=l.task_runs.response)==null?void 0:t.value)||[]}),le=n(()=>[{label:"Task Runs",href:"task_runs",count:oe.value,icon:"pi-task"},{label:"Subflow Runs",href:"sub_flow_runs",count:ae.value,icon:"pi-flow-run"},{label:"Logs",href:"logs",icon:"pi-logs-fill"}]),re=n(()=>C.value.type=="PENDING"||C.value.type=="SCHEDULED"?"--":_.value.total_run_time?Z(_.value.total_run_time):Z(_.value.estimated_run_time));ye(()=>{c.stopPolling(),k.queries.delete(c.id)});const ue=N(f,()=>{a.value=f==null?void 0:f.params.id});return xe(()=>{ue()}),N(a,async()=>{!a.value||(await c.fetch(),l.flow.fetch(),l.task_runs_count.fetch(),l.task_runs.fetch(),l.sub_flow_runs_count.fetch(),S.value?l.deployment.fetch():l.deployment.clearResult(),$.value?l.parent_flow.fetch():l.parent_flow.clearResult(),$.value?l.parent_flow_run.fetch():l.parent_flow_run.clearResult(),u.value="task_runs")}),(t,m)=>{const ie=F("m-tags"),P=F("router-link"),U=F("m-card"),J=F("m-icon-button"),K=F("ResultsList");return i(),v(Re,null,[s("div",We,[r(U,{class:"details",shadow:"sm"},{default:d(()=>[s("div",Oe,[s("div",ze,[s("div",Je,[s("span",Ke,[r($e,{name:e(C).name,type:e(C).type,class:"mr-1"},null,8,["name","type"]),r(ie,{tags:e(ne),class:"mr-1 caption"},null,8,["tags"]),s("div",Qe,[e(_).start_time?(i(),v("span",Xe,[Ye,s("span",Ze,x(e(ee)(e(_).start_time)),1)])):y("",!0),e(_).end_time?(i(),v("span",et,[tt,s("span",st,x(e(ee)(e(_).end_time)),1)])):y("",!0)])])]),s("div",nt,[e(L).name?(i(),v("span",ot,[at,s("span",lt,x(e(L).name),1)])):y("",!0),e(G).name?(i(),v("span",rt,[ut,s("span",it,x(e(G).name),1),ct,r(P,{to:`/flow-run/${e(W).id}`,class:"mr-1 ml--half text--primary"},{default:d(()=>[h(x(e(W).name),1)]),_:1},8,["to"])])):y("",!0),e(O)?(i(),v("span",_t,[dt,s("span",pt,x(e(O)),1)])):y("",!0),e(_).flow_version?(i(),v("span",ft,[mt,s("span",vt,x(e(_).flow_version),1)])):y("",!0)])]),s("div",ht,x(e(re)),1)])]),_:1}),r(U,{class:"timeline d-flex flex-column",width:"auto",shadow:"sm"},{header:d(()=>[s("div",gt,[bt,r(P,{to:`/flow-run/${a.value}/timeline`},{default:d(()=>[r(J,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:d(()=>[s("div",wt,[e(z).length?(i(),B(Ce,{key:0,items:e(z),"max-end-time":e(te),"hide-header":"","axis-position":"bottom","background-color":"blue-5"},null,8,["items","max-end-time"])):y("",!0)])]),_:1}),r(U,{class:"radar",shadow:"sm"},{header:d(()=>[s("div",yt,[xt,r(P,{to:`/flow-run/${a.value}/radar`},{default:d(()=>[r(J,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:d(()=>[s("div",kt,[r(Be,{id:a.value},null,8,["id"])])]),_:1})]),r(Se,{tab:u.value,"onUpdate:tab":m[0]||(m[0]=ce=>u.value=ce),tabs:e(le),class:"mt-3"},null,8,["tab","tabs"]),e(R).value>0?(i(),v("div",Rt,[s("span",null,x(e(R).value.toLocaleString())+" "+x(e(Le)("Result",e(R))),1)])):y("",!0),s("section",It,[r(ke,{name:"tab-fade",mode:"out-in",css:""},{default:d(()=>[e(R).value===0?(i(),v("div",Tt,$t)):u.value=="task_runs"?(i(),B(K,{key:"task_runs",filter:e(w),component:"ListItemTaskRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):u.value=="sub_flow_runs"?(i(),B(K,{key:"sub_flow_runs",filter:e(T),component:"ListItemSubFlowRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):u.value=="logs"?(i(),B(Ge,{key:3,"flow-run-id":a.value,running:e(se)},null,8,["flow-run-id","running"])):y("",!0)]),_:1})]),St],64)}}});var Dt=Fe(Lt,[["__scopeId","data-v-3348cf19"]]);export{Dt as default};
