{# Copyright 2020 Karlsruhe Institute of Technology
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #     http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License. #}

<div class="float-md-right mb-3 mb-md-0 ml-0 ml-md-3">
  <div class="btn-group">
    <button type="button" class="btn btn-sm btn-light dropdown-toggle" data-toggle="dropdown">
      {% trans %}Export{% endtrans %}
    </button>
    <div class="dropdown-menu">
      {% for export_type, title in config["EXPORT_TYPES"]["collection"].items() %}
        <a href="{{ url_for('collections.export_collection', id=collection.id, export_type=export_type) }}"
           class="dropdown-item">
          {{ title }}
        </a>
      {% endfor %}
    </div>
  </div>
  {% if publication_providers %}
    <div class="btn-group">
      <button type="button" class="btn btn-sm btn-light dropdown-toggle" data-toggle="dropdown">
        {% trans %}Publish{% endtrans %}
      </button>
      <div class="dropdown-menu">
        {% for provider in publication_providers %}
          <a href="{{ url_for('collections.publish_collection', id=collection.id, provider=provider.name) }}"
             class="dropdown-item">
            {{ provider.title }}
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {% set can_link_collection = has_permission(current_user, "link", "collection", collection.id) %}
  {% set can_create_records = has_permission(current_user, "create", "record", None) %}
  {% set can_create_collections = has_permission(current_user, "create", "collection", None) %}

  {% if can_link_collection or can_create_records or can_create_collections %}
    <br class="d-md-none">
  {% endif %}

  {% if can_link_collection or can_create_records %}
    <div class="btn-group mt-2 mt-md-0">
      <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown">
        {% trans %}Add record{% endtrans %}
      </button>
      <div class="dropdown-menu">
        {% if can_link_collection %}
          <a href="{{ url_for('collections.manage_links', id=collection.id) }}" class="dropdown-item">
            {% trans %}Existing record{% endtrans %}
          </a>
        {% endif %}
        {% if can_create_records %}
          <a href="{{ url_for('records.new_record', collection=collection.id) }}" class="dropdown-item">
            {% trans %}New record{% endtrans %}
          </a>
        {% endif %}
      </div>
    </div>
  {% endif %}

  {% if can_create_collections %}
    <a href="{{ url_for('collections.new_collection', collection=collection.id) }}"
       class="btn btn-sm btn-primary mt-2 mt-md-0">
      {% trans %}Copy collection{% endtrans %}
    </a>
  {% endif %}
</div>

{% snippet "resources/basic_info", resource=collection %}

{% if collection.tags.count() > 0 %}
  <hr>
  <strong class="mr-3">{% trans %}Tags{% endtrans %}</strong>
  {% for tag in collection.tags.order_by("name") %}
    <h5 class="d-inline">
      <a href="{{ url_for('collections.collections', tag=tag.name) }}"
         class="badge badge-light border border-muted font-weight-normal my-1 mx-1"
         title="{{ tag.name }}">
        {{ tag.name | truncate(25) }}
      </a>
    </h5>
  {% endfor %}
{% endif %}

<hr>
<resource-view title="{% trans %}Records{% endtrans %}"
               placeholder="{% trans %}No records.{% endtrans %}"
               :endpoint="getRecordsEndpoint"
               :per-page="6">
  <div class="row">
    <div class="col-md-6 offset-lg-6 d-lg-flex justify-content-end mb-4 mb-lg-0">
      <a class="btn btn-sm btn-block btn-light" :href="searchRecordsEndpoint">
        <i class="fa-solid fa-magnifying-glass"></i> {% trans %}Advanced search{% endtrans %}
      </a>
    </div>
  </div>
</resource-view>
{% if num_children %}
  <div class="form-check form-check-inline mt-3">
    <input type="checkbox" class="form-check-input" id="child-collections" v-model="includeChildCollections">
    <label class="form-check-label" for="child-collections">{% trans %}Include child collections{% endtrans %}</label>
  </div>
{% endif %}
