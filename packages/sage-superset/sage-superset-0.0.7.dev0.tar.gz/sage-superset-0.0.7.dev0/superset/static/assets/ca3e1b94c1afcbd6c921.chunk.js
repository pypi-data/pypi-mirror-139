"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[2651],{2651:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ye});var n=a(11965),i=a(15926),s=a.n(i),o=a(67294),l=a(45697),r=a.n(l),d=a(82191),c=a(87183),h=a(57011),u=a(29487),m=a(82607),p=a(14670),g=a.n(p),b=a(51995),f=a(61988),Z=a(31069),y=a(68135),C=a(4715),v=a(49238),_=a(35932),x=a(40637),S=a(79789),w=a(86057),k=a(73995),E=a(37921),D=a(38703),T=a(17982),I=a(38270),M=a(98286),L=a(79069),N=a(79684),K=a(42878),A=a(665),P=a(70163);function $(e,t,a){return o.Children.map(e,(e=>{let n=e;return e&&e.type.name===t.name&&(n=o.cloneElement(e,a(e))),n&&n.props.children&&(n=o.cloneElement(n,{children:$(n.props.children,t,a)})),n}))}var q=a(58593);const R=n.iv`
  .ant-form-item-control-input-content {
    display: flex;
    flex-direction: row;
  }
`;function U({fieldKey:e,value:t,label:a,description:i=null,control:s,onChange:l=(()=>{}),compact:r=!1,inline:d}){const c=(0,o.useCallback)((t=>{l(e,t)}),[l,e]),h=o.cloneElement(s,{value:t,onChange:c});return(0,n.tZ)(v.xJ,{label:(0,n.tZ)(v.lX,{className:"m-r-5"},a||e,r&&i&&(0,n.tZ)(q.u,{id:"field-descr",placement:"right",title:i},(0,n.tZ)("i",{className:"fa fa-info-circle m-l-5"}))),css:d&&R},h,!r&&i&&(0,n.tZ)("div",{css:e=>({color:e.colors.grayscale.base,[d?"marginLeft":"marginTop"]:e.gridUnit})},i))}class F extends o.PureComponent{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e,t){return this.props.onChange({...this.props.item,[e]:t})}render(){const{title:e}=this.props;return(0,n.tZ)(v.l0,{className:"CRUD",layout:"vertical"},e&&(0,n.tZ)("legend",null,e),$(this.props.children,U,(e=>({onChange:this.onChange,value:this.props.item[e.props.fieldKey],compact:this.props.compact}))))}}var O;function B(e){const t=e.map((e=>({...e,id:e.id||g().generate()}))),a={};return t.forEach((e=>{a[e.id]=e})),{collection:a,collectionArray:t}}F.defaultProps={compact:!1,title:null},function(e){e[e.asc=1]="asc",e[e.desc=2]="desc",e[e.unsort=0]="unsort"}(O||(O={}));const z=b.iK.div`
  ${({stickyHeader:e})=>e&&"\n      height: 350px;\n      overflow-y: auto;\n      overflow-x: auto;\n\n      .table {\n        min-width: 800px;\n      }\n      thead th {\n        background: #fff;\n        position: sticky;\n        top: 0;\n        z-index: 9;\n        min\n      }\n    "}
  th span {
    vertical-align: ${({theme:e})=>-2*e.gridUnit}px;
  }
`,j=b.iK.div`
  text-align: right;
  ${({theme:e})=>`margin-bottom: ${2*e.gridUnit}px`}
`;class G extends o.PureComponent{constructor(e){super(e);const{collection:t,collectionArray:a}=B(e.collection);this.state={expandedColumns:{},collection:t,collectionArray:a,sortColumn:"",sort:0},this.renderItem=this.renderItem.bind(this),this.onAddItem=this.onAddItem.bind(this),this.renderExpandableSection=this.renderExpandableSection.bind(this),this.getLabel=this.getLabel.bind(this),this.onFieldsetChange=this.onFieldsetChange.bind(this),this.renderTableBody=this.renderTableBody.bind(this),this.changeCollection=this.changeCollection.bind(this),this.sortColumn=this.sortColumn.bind(this),this.renderSortIcon=this.renderSortIcon.bind(this)}UNSAFE_componentWillReceiveProps(e){if(e.collection!==this.props.collection){const{collection:t,collectionArray:a}=B(e.collection);this.setState({collection:t,collectionArray:a})}}onCellChange(e,t,a){this.changeCollection({...this.state.collection,[e]:{...this.state.collection[e],[t]:a}})}onAddItem(){if(this.props.itemGenerator){let e=this.props.itemGenerator();e.id||(e={...e,id:g().generate()}),this.changeCollection(this.state.collection,e)}}onFieldsetChange(e){this.changeCollection({...this.state.collection,[e.id]:e})}getLabel(e){const{columnLabels:t}=this.props;let a=t&&t[e]?t[e]:e;return a.startsWith("__")&&(a=""),a}changeCollection(e,t){if(this.setState({collection:e}),this.props.onChange){const a=this.state.collectionArray.map((t=>e[t.id])).filter((e=>void 0!==e));t&&a.unshift(t),this.props.onChange(a)}}deleteItem(e){const t={...this.state.collection};delete t[e],this.changeCollection(t)}effectiveTableColumns(){const{tableColumns:e,allowDeletes:t,expandFieldset:a}=this.props,n=t?e.concat(["__actions"]):e;return a?["__expand"].concat(n):n}toggleExpand(e){this.onCellChange(e,"__expanded",!1),this.setState((t=>({expandedColumns:{...t.expandedColumns,[e]:!t.expandedColumns[e]}})))}sortColumn(e,t=O.unsort){const{sortColumns:a}=this.props;return()=>{if(null!=a&&a.includes(e)){if(t===O.unsort){const{collection:e}=B(this.props.collection),a=function(e){return Object.keys(e).map((t=>e[t]))}(e);return void this.setState({collectionArray:a,sortColumn:"",sort:t})}const a=[...this.state.collectionArray].sort(((t,a)=>{return n=t[e],i=a[e],"string"==typeof n?(n||" ").localeCompare(i):n-i;var n,i})),n=t===O.asc?a:a.reverse();this.setState((a=>({...a,collectionArray:n,sortColumn:e,sort:t})))}}}renderSortIcon(e){return this.state.sortColumn===e&&this.state.sort===O.asc?(0,n.tZ)(P.Z.SortAsc,{onClick:this.sortColumn(e,2)}):this.state.sortColumn===e&&this.state.sort===O.desc?(0,n.tZ)(P.Z.SortDesc,{onClick:this.sortColumn(e,0)}):(0,n.tZ)(P.Z.Sort,{onClick:this.sortColumn(e,1)})}renderHeaderRow(){const e=this.effectiveTableColumns(),{allowDeletes:t,expandFieldset:a,extraButtons:i,sortColumns:s}=this.props;return(0,n.tZ)("thead",null,(0,n.tZ)("tr",null,a&&(0,n.tZ)("th",{"aria-label":"Expand",className:"tiny-cell"}),e.map((e=>(0,n.tZ)("th",{key:e},this.getLabel(e),(null==s?void 0:s.includes(e))&&this.renderSortIcon(e)))),i,t&&(0,n.tZ)("th",{key:"delete-item","aria-label":"Delete",className:"tiny-cell"})))}renderExpandableSection(e){return $(this.props.expandFieldset,F,(()=>({item:e,onChange:this.onFieldsetChange})))}renderCell(e,t){const a=this.props.itemRenderers&&this.props.itemRenderers[t],n=e[t],i=this.onCellChange.bind(this,e.id,t);return a?a(n,i,this.getLabel(t),e):n}renderItem(e){const{allowAddItem:t,allowDeletes:a,expandFieldset:i,tableColumns:s}=this.props,o=!!this.state.expandedColumns[e.id]||e.__expanded;let l=[];i&&l.push((0,n.tZ)("td",{key:"__expand",className:"expand"},(0,n.tZ)("i",{role:"button","aria-label":"Toggle expand",tabIndex:0,className:`fa fa-caret-${o?"down":"right"} text-primary pointer`,onClick:this.toggleExpand.bind(this,e.id)}))),l=l.concat(s.map((t=>(0,n.tZ)("td",{key:t},this.renderCell(e,t))))),t&&l.push((0,n.tZ)("td",{key:"add"})),a&&l.push((0,n.tZ)("td",{key:"__actions",className:"text-primary"},(0,n.tZ)(P.Z.Trash,{"aria-label":"Delete item",className:"pointer",role:"button",tabIndex:0,onClick:this.deleteItem.bind(this,e.id)})));const r=[(0,n.tZ)("tr",{"data-test":"table-row",className:"row",key:e.id},l)];return o&&r.push((0,n.tZ)("tr",{className:"exp",key:`exp__${e.id}`},(0,n.tZ)("td",{colSpan:this.effectiveTableColumns().length,className:"expanded"},(0,n.tZ)("div",null,this.renderExpandableSection(e))))),r}renderEmptyCell(){return(0,n.tZ)("tr",null,(0,n.tZ)("td",{className:"empty-collection"},this.props.emptyMessage))}renderTableBody(){const e=this.state.collectionArray,t=e.length?e.map((e=>this.renderItem(e))):this.renderEmptyCell();return(0,n.tZ)("tbody",null,t)}render(){return(0,n.tZ)(o.Fragment,null,(0,n.tZ)(j,null,this.props.allowAddItem&&(0,n.tZ)("span",{className:"m-t-10 m-r-10"},(0,n.tZ)(_.Z,{buttonSize:"small",buttonStyle:"tertiary",onClick:this.onAddItem},(0,n.tZ)("i",{className:"fa fa-plus"})," ",(0,f.t)("Add item")))),(0,n.tZ)(z,{className:"CRUD",stickyHeader:this.props.stickyHeader},(0,n.tZ)("table",{className:"table"},this.renderHeaderRow(),this.renderTableBody())))}}var X=a(14114),H=a(91877),J=a(93185);const W=b.iK.div`
  .change-warning {
    margin: 16px 10px 0;
    color: ${({theme:e})=>e.colors.warning.base};
  }

  .change-warning .bold {
    font-weight: ${({theme:e})=>e.typography.weights.bold};
  }

  .form-group.has-feedback > .help-block {
    margin-top: 8px;
  }

  .form-group.form-group-md {
    margin-bottom: 8px;
  }
`,Q=b.iK.div`
  align-items: center;
  display: flex;

  svg {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,V=(0,b.iK)(x.ZP)`
  overflow: visible;
  .ant-tabs-content-holder {
    overflow: visible;
  }
`,Y=(0,b.iK)(m.Z)`
  .ant-badge-count {
    line-height: ${({theme:e})=>4*e.gridUnit}px;
    height: ${({theme:e})=>4*e.gridUnit}px;
    margin-left: ${({theme:e})=>e.gridUnit}px;
  }
`,ee=b.iK.div`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  display: flex;
  align-items: center;
  a {
    padding: 0 10px;
  }
`,te=b.iK.div`
  text-align: right;
  ${({theme:e})=>`margin-bottom: ${2*e.gridUnit}px`}
`,ae=b.iK.div`
  display: flex;
  align-items: center;
  span {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,ne=b.iK.div`
  .table > tbody > tr > td {
    vertical-align: middle;
  }

  .ant-tag {
    margin-top: ${({theme:e})=>e.gridUnit}px;
  }
`,ie=(e,t)=>(0,n.tZ)(L.Z,{value:e,onChange:t}),se=[{value:"STRING",label:"STRING"},{value:"NUMERIC",label:"NUMERIC"},{value:"DATETIME",label:"DATETIME"},{value:"BOOLEAN",label:"BOOLEAN"}],oe=[{key:"physical",label:(0,f.t)("Physical (table or view)")},{key:"virtual",label:(0,f.t)("Virtual (SQL)")}],le={};oe.forEach((e=>{le[e.key]=e}));var re={name:"s5xdrg",styles:"display:flex;align-items:center"};function de({title:e,collection:t}){return(0,n.tZ)("div",{css:re},e," ",(0,n.tZ)(Y,{count:t?t.length:0,showZero:!0}))}function ce({columns:e,datasource:t,onColumnsChange:a,onDatasourceChange:i,editableColumnName:s,showExpression:o,allowAddItem:l,allowEditDataType:r,itemGenerator:d}){return(0,n.tZ)(G,{collection:e,tableColumns:["column_name","type","is_dttm","main_dttm_col","filterable","groupby"],sortColumns:["column_name","type","is_dttm","main_dttm_col","filterable","groupby"],allowDeletes:!0,allowAddItem:l,itemGenerator:d,stickyHeader:!0,expandFieldset:(0,n.tZ)(ue,null,(0,n.tZ)(F,{compact:!0},o&&(0,n.tZ)(U,{fieldKey:"expression",label:(0,f.t)("SQL expression"),control:(0,n.tZ)(K.Z,{language:"markdown",offerEditInModal:!1})}),(0,n.tZ)(U,{fieldKey:"verbose_name",label:(0,f.t)("Label"),control:(0,n.tZ)(N.Z,{controlId:"verbose_name",placeholder:(0,f.t)("Label")})}),(0,n.tZ)(U,{fieldKey:"description",label:(0,f.t)("Description"),control:(0,n.tZ)(N.Z,{controlId:"description",placeholder:(0,f.t)("Description")})}),r&&(0,n.tZ)(U,{fieldKey:"type",label:(0,f.t)("Data type"),control:(0,n.tZ)(C.P,{ariaLabel:(0,f.t)("Data type"),options:se,name:"type",allowNewOptions:!0,allowClear:!0})}),(0,n.tZ)(U,{fieldKey:"python_date_format",label:(0,f.t)("Datetime format"),description:(0,n.tZ)("div",null,(0,f.t)("The pattern of timestamp format. For strings use "),(0,n.tZ)("a",{href:"https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior"},(0,f.t)("Python datetime string pattern")),(0,f.t)(" expression which needs to adhere to the "),(0,n.tZ)("a",{href:"https://en.wikipedia.org/wiki/ISO_8601"},(0,f.t)("ISO 8601")),(0,f.t)(" standard to ensure that the lexicographical ordering\n                      coincides with the chronological ordering. If the\n                      timestamp format does not adhere to the ISO 8601 standard\n                      you will need to define an expression and type for\n                      transforming the string into a date or timestamp. Note\n                      currently time zones are not supported. If time is stored\n                      in epoch format, put `epoch_s` or `epoch_ms`. If no pattern\n                      is specified we fall back to using the optional defaults on a per\n                      database/column name level via the extra parameter.")),control:(0,n.tZ)(N.Z,{controlId:"python_date_format",placeholder:"%Y/%m/%d"})}),(0,n.tZ)(U,{fieldKey:"certified_by",label:(0,f.t)("Certified By"),description:(0,f.t)("Person or group that has certified this metric"),control:(0,n.tZ)(N.Z,{controlId:"certified",placeholder:(0,f.t)("Certified by")})}),(0,n.tZ)(U,{fieldKey:"certification_details",label:(0,f.t)("Certification details"),description:(0,f.t)("Details of the certification"),control:(0,n.tZ)(N.Z,{controlId:"certificationDetails",placeholder:(0,f.t)("Certification details")})}))),columnLabels:{column_name:(0,f.t)("Column"),type:(0,f.t)("Data type"),groupby:(0,f.t)("Is dimension"),is_dttm:(0,f.t)("Is temporal"),main_dttm_col:(0,f.t)("Default datetime"),filterable:(0,f.t)("Is filterable")},onChange:a,itemRenderers:{column_name:(e,t,a,i)=>s?(0,n.tZ)(ae,null,i.is_certified&&(0,n.tZ)(S.Z,{certifiedBy:i.certified_by,details:i.certification_details}),(0,n.tZ)(N.Z,{value:e,onChange:t})):(0,n.tZ)(ae,null,i.is_certified&&(0,n.tZ)(S.Z,{certifiedBy:i.certified_by,details:i.certification_details}),e),main_dttm_col:(a,s,o,l)=>{const r=t.main_dttm_col===l.column_name,d=!e.find((e=>e.column_name===l.column_name)).is_dttm;return(0,n.tZ)(c.Y,{checked:r,disabled:d,onChange:()=>i({...t,main_dttm_col:l.column_name})})},type:e=>e?(0,n.tZ)(E.Z,null,e):null,is_dttm:ie,filterable:ie,groupby:ie}})}function he({label:e,formElement:t}){return(0,n.tZ)("div",null,(0,n.tZ)("div",null,(0,n.tZ)("strong",null,e)),(0,n.tZ)("div",null,t))}function ue({children:e}){return(0,n.tZ)(h.Z,{padded:!0},e)}de.propTypes={title:r().string,collection:r().array},ce.propTypes={columns:r().array.isRequired,datasource:r().object.isRequired,onColumnsChange:r().func.isRequired,onDatasourceChange:r().func.isRequired,editableColumnName:r().bool,showExpression:r().bool,allowAddItem:r().bool,allowEditDataType:r().bool,itemGenerator:r().func},ce.defaultProps={editableColumnName:!1,showExpression:!1,allowAddItem:!1,allowEditDataType:!1,itemGenerator:()=>({column_name:"<new column>",filterable:!0,groupby:!0})},he.propTypes={label:r().string,formElement:r().node},ue.propTypes={children:r().node};const me={datasource:r().object.isRequired,onChange:r().func,addSuccessToast:r().func.isRequired,addDangerToast:r().func.isRequired};function pe({datasource:e,onChange:t}){const a=(0,o.useCallback)(((e="",t,a)=>{const n=s().encode({filter:e,page:t,page_size:a});return Z.Z.get({endpoint:`/api/v1/dataset/related/owners?q=${n}`}).then((e=>({data:e.json.result.map((e=>({value:e.value,label:e.text}))),totalCount:e.json.count})))}),[]);return(0,n.tZ)(C.P,{ariaLabel:(0,f.t)("Select owners"),mode:"multiple",name:"owners",value:e.owners,options:a,onChange:t,header:(0,n.tZ)(v.lX,null,(0,f.t)("Owners")),allowClear:!0})}var ge={name:"hkh81z",styles:"margin-top:8px"},be={name:"hkh81z",styles:"margin-top:8px"};class fe extends o.PureComponent{constructor(e){var t;super(e),this.state={datasource:{...e.datasource,owners:e.datasource.owners.map((e=>({value:e.value||e.id,label:e.label||`${e.first_name} ${e.last_name}`}))),metrics:null==(t=e.datasource.metrics)?void 0:t.map((e=>{const{certified_by:t,certification_details:a}=e,{certification:{details:n,certified_by:i}={},warning_markdown:s}=JSON.parse(e.extra||"{}")||{};return{...e,certification_details:a||n,warning_markdown:s||"",certified_by:i||t}}))},errors:[],isDruid:"druid"===e.datasource.type||"druid"===e.datasource.datasource_type,isSqla:"table"===e.datasource.datasource_type||"table"===e.datasource.type,isEditMode:!1,databaseColumns:e.datasource.columns.filter((e=>!e.expression)),calculatedColumns:e.datasource.columns.filter((e=>!!e.expression)),metadataLoading:!1,activeTabKey:0,datasourceType:e.datasource.sql?le.virtual.key:le.physical.key},this.onChange=this.onChange.bind(this),this.onChangeEditMode=this.onChangeEditMode.bind(this),this.onDatasourcePropChange=this.onDatasourcePropChange.bind(this),this.onDatasourceChange=this.onDatasourceChange.bind(this),this.tableChangeAndSyncMetadata=this.tableChangeAndSyncMetadata.bind(this),this.syncMetadata=this.syncMetadata.bind(this),this.setColumns=this.setColumns.bind(this),this.validateAndChange=this.validateAndChange.bind(this),this.handleTabSelect=this.handleTabSelect.bind(this),this.allowEditSource=!(0,H.cr)(J.T.DISABLE_DATASET_SOURCE_EDIT)}onChange(){const{datasourceType:e,datasource:t}=this.state,a=e===le.physical.key?"":t.sql,n={...this.state.datasource,sql:a,columns:[...this.state.databaseColumns,...this.state.calculatedColumns]};this.props.onChange(n,this.state.errors)}onChangeEditMode(){this.setState((e=>({isEditMode:!e.isEditMode})))}onDatasourceChange(e,t=this.validateAndChange){this.setState({datasource:e},t)}onDatasourcePropChange(e,t){if(void 0===t)return;const a={...this.state.datasource,[e]:t};this.setState((a=>({datasource:{...a.datasource,[e]:t}})),"table_name"===e?this.onDatasourceChange(a,this.tableChangeAndSyncMetadata):this.onDatasourceChange(a,this.validateAndChange))}onDatasourceTypeChange(e){this.setState({datasourceType:e})}setColumns(e){this.setState(e,this.validateAndChange)}validateAndChange(){this.validate(this.onChange)}tableChangeAndSyncMetadata(){this.validate((()=>{this.syncMetadata(),this.onChange()}))}updateColumns(e){const{databaseColumns:t}=this.state,a=e.map((e=>e.name)),n=t.reduce(((e,t)=>({...e,[t.column_name]:t})),{}),i=[],s={added:[],modified:[],removed:t.map((e=>e.column_name)).filter((e=>!a.includes(e)))};return e.forEach((e=>{const t=n[e.name];t?t.type!==e.type||!t.is_dttm&&e.is_dttm?(i.push({...t,type:e.type,is_dttm:t.is_dttm||e.is_dttm}),s.modified.push(e.name)):i.push(t):(i.push({id:g().generate(),column_name:e.name,type:e.type,groupby:!0,filterable:!0,is_dttm:e.is_dttm}),s.added.push(e.name))})),(s.added.length||s.modified.length||s.removed.length)&&this.setColumns({databaseColumns:i}),s}syncMetadata(){const{datasource:e}=this.state,t={datasource_type:e.type||e.datasource_type,database_name:e.database.database_name||e.database.name,schema_name:e.schema,table_name:e.table_name};Object.entries(t).forEach((([e,a])=>{void 0===a&&(t[e]=null)}));const a=`/datasource/external_metadata_by_name/?q=${s().encode(t)}`;this.setState({metadataLoading:!0}),Z.Z.get({endpoint:a}).then((({json:e})=>{const t=this.updateColumns(e);t.modified.length&&this.props.addSuccessToast((0,f.t)("Modified columns: %s",t.modified.join(", "))),t.removed.length&&this.props.addSuccessToast((0,f.t)("Removed columns: %s",t.removed.join(", "))),t.added.length&&this.props.addSuccessToast((0,f.t)("New columns added: %s",t.added.join(", "))),this.props.addSuccessToast((0,f.t)("Metadata has been synced")),this.setState({metadataLoading:!1})})).catch((e=>(0,M.O)(e).then((({error:e,statusText:t})=>{this.props.addDangerToast(e||t||(0,f.t)("An error has occurred")),this.setState({metadataLoading:!1})}))))}findDuplicates(e,t){const a={},n=[];return e.forEach((e=>{const i=t(e);i in a?n.push(i):a[i]=null})),n}validate(e){let t,a=[];const{datasource:n}=this.state;t=this.findDuplicates(n.columns,(e=>e.column_name)),a=a.concat(t.map((e=>(0,f.t)("Column name [%s] is duplicated",e)))),t=this.findDuplicates(n.metrics,(e=>e.metric_name)),a=a.concat(t.map((e=>(0,f.t)("Metric name [%s] is duplicated",e))));const i=this.state.calculatedColumns.filter((e=>!e.expression&&!e.json));a=a.concat(i.map((e=>(0,f.t)("Calculated column [%s] requires an expression",e.column_name)))),this.setState({errors:a},e)}handleTabSelect(e){this.setState({activeTabKey:e})}sortMetrics(e){return e.sort((({id:e},{id:t})=>t-e))}renderSettingsFieldset(){const{datasource:e}=this.state;return(0,n.tZ)(F,{title:(0,f.t)("Basic"),item:e,onChange:this.onDatasourceChange},(0,n.tZ)(U,{fieldKey:"description",label:(0,f.t)("Description"),control:(0,n.tZ)(K.Z,{language:"markdown",offerEditInModal:!1})}),(0,n.tZ)(U,{fieldKey:"default_endpoint",label:(0,f.t)("Default URL"),description:(0,f.t)("Default URL to redirect to when accessing from the dataset list page"),control:(0,n.tZ)(N.Z,{controlId:"default_endpoint"})}),(0,n.tZ)(U,{inline:!0,fieldKey:"filter_select_enabled",label:(0,f.t)("Autocomplete filters"),description:(0,f.t)("Whether to populate autocomplete filters options"),control:(0,n.tZ)(L.Z,null)}),this.state.isSqla&&(0,n.tZ)(U,{fieldKey:"fetch_values_predicate",label:(0,f.t)("Autocomplete query predicate"),description:(0,f.t)('When using "Autocomplete filters", this can be used to improve performance of the query fetching the values. Use this option to apply a predicate (WHERE clause) to the query selecting the distinct values from the table. Typically the intent would be to limit the scan by applying a relative time filter on a partitioned or indexed time-related field.'),control:(0,n.tZ)(K.Z,{language:"sql",controlId:"fetch_values_predicate",minLines:5})}),this.state.isSqla&&(0,n.tZ)(U,{fieldKey:"extra",label:(0,f.t)("Extra"),description:(0,f.t)('Extra data to specify table metadata. Currently supports metadata of the format: `{ "certification": { "certified_by": "Data Platform Team", "details": "This table is the source of truth." }, "warning_markdown": "This is a warning." }`.'),control:(0,n.tZ)(K.Z,{controlId:"extra",language:"json",offerEditInModal:!1})}),(0,n.tZ)(pe,{datasource:e,onChange:t=>{this.onDatasourceChange({...e,owners:t})}}))}renderAdvancedFieldset(){const{datasource:e}=this.state;return(0,n.tZ)(F,{title:(0,f.t)("Advanced"),item:e,onChange:this.onDatasourceChange},(0,n.tZ)(U,{fieldKey:"cache_timeout",label:(0,f.t)("Cache timeout"),description:(0,f.t)("The duration of time in seconds before the cache is invalidated"),control:(0,n.tZ)(N.Z,{controlId:"cache_timeout"})}),(0,n.tZ)(U,{fieldKey:"offset",label:(0,f.t)("Hours offset"),control:(0,n.tZ)(N.Z,{controlId:"offset"}),description:(0,f.t)("The number of hours, negative or positive, to shift the time column. This can be used to move UTC time to local time.")}),this.state.isSqla&&(0,n.tZ)(U,{fieldKey:"template_params",label:(0,f.t)("Template parameters"),description:(0,f.t)("A set of parameters that become available in the query using Jinja templating syntax"),control:(0,n.tZ)(N.Z,{controlId:"template_params"})}))}renderSpatialTab(){const{datasource:e}=this.state,{spatials:t,all_cols:a}=e;return(0,n.tZ)(x.ZP.TabPane,{tab:(0,n.tZ)(de,{collection:t,title:(0,f.t)("Spatial")}),key:4},(0,n.tZ)(G,{tableColumns:["name","config"],onChange:this.onDatasourcePropChange.bind(this,"spatials"),itemGenerator:()=>({name:"<new spatial>",type:"<no type>",config:null}),collection:t,allowDeletes:!0,itemRenderers:{name:(e,t)=>(0,n.tZ)(I.Z,{canEdit:!0,title:e,onSaveTitle:t}),config:(e,t)=>(0,n.tZ)(A.Z,{value:e,onChange:t,choices:a})}}))}renderSourceFieldset(e){const{datasource:t}=this.state;return(0,n.tZ)("div",null,this.allowEditSource&&(0,n.tZ)(ee,null,(0,n.tZ)("span",{role:"button",tabIndex:0,onClick:this.onChangeEditMode},this.state.isEditMode?(0,n.tZ)(P.Z.LockUnlocked,{iconColor:e.colors.grayscale.base}):(0,n.tZ)(P.Z.LockLocked,{iconColor:e.colors.grayscale.base})),!this.state.isEditMode&&(0,n.tZ)("div",null,(0,f.t)("Click the lock to make changes.")),this.state.isEditMode&&(0,n.tZ)("div",null,(0,f.t)("Click the lock to prevent further changes."))),(0,n.tZ)("div",{className:"m-l-10 m-t-20 m-b-10"},oe.map((e=>(0,n.tZ)(c.Y,{key:e.key,value:e.key,inline:!0,onChange:this.onDatasourceTypeChange.bind(this,e.key),checked:this.state.datasourceType===e.key,disabled:!this.state.isEditMode},e.label)))),(0,n.tZ)("hr",null),(0,n.tZ)(F,{item:t,onChange:this.onDatasourceChange,compact:!0},this.state.datasourceType===le.virtual.key&&(0,n.tZ)("div",null,this.state.isSqla&&(0,n.tZ)(o.Fragment,null,(0,n.tZ)(d.JX,{xs:24,md:12},(0,n.tZ)(U,{fieldKey:"databaseSelector",label:(0,f.t)("virtual"),control:(0,n.tZ)("div",{css:ge},(0,n.tZ)(k.Z,{db:null==t?void 0:t.database,schema:t.schema,onSchemaChange:e=>this.state.isEditMode&&this.onDatasourcePropChange("schema",e),onDbChange:e=>this.state.isEditMode&&this.onDatasourcePropChange("database",e),formMode:!1,handleError:this.props.addDangerToast,readOnly:!this.state.isEditMode}))}),(0,n.tZ)("div",{css:(0,n.iv)({width:"calc(100% - 34px)",marginTop:-16},"","")},(0,n.tZ)(U,{fieldKey:"table_name",label:(0,f.t)("Dataset name"),control:(0,n.tZ)(N.Z,{controlId:"table_name",onChange:e=>{this.onDatasourcePropChange("table_name",e)},placeholder:(0,f.t)("Dataset name"),disabled:!this.state.isEditMode})}))),(0,n.tZ)(U,{fieldKey:"sql",label:(0,f.t)("SQL"),description:(0,f.t)("When specifying SQL, the datasource acts as a view. Superset will use this statement as a subquery while grouping and filtering on the generated parent queries."),control:(0,n.tZ)(K.Z,{language:"sql",offerEditInModal:!1,minLines:20,maxLines:20,readOnly:!this.state.isEditMode})})),this.state.isDruid&&(0,n.tZ)(U,{fieldKey:"json",label:(0,f.t)("JSON"),description:(0,n.tZ)("div",null,(0,f.t)("The JSON metric or post aggregation definition.")),control:(0,n.tZ)(K.Z,{language:"json",offerEditInModal:!1})})),this.state.datasourceType===le.physical.key&&(0,n.tZ)(d.JX,{xs:24,md:12},this.state.isSqla&&(0,n.tZ)(U,{fieldKey:"tableSelector",label:(0,f.t)("Physical"),control:(0,n.tZ)("div",{css:be},(0,n.tZ)(T.Z,{clearable:!1,database:{...t.database,database_name:t.database.database_name||t.database.name},dbId:t.database.id,handleError:this.props.addDangerToast,schema:t.schema,sqlLabMode:!1,tableName:t.table_name,onSchemaChange:this.state.isEditMode?e=>this.onDatasourcePropChange("schema",e):void 0,onDbChange:this.state.isEditMode?e=>this.onDatasourcePropChange("database",e):void 0,onTableChange:this.state.isEditMode?e=>this.onDatasourcePropChange("table_name",e):void 0,readOnly:!this.state.isEditMode})),description:(0,f.t)("The pointer to a physical table (or view). Keep in mind that the chart is associated to this Superset logical table, and this logical table points the physical table referenced here.")}))))}renderErrors(){return this.state.errors.length>0?(0,n.tZ)(u.Z,{css:e=>({marginBottom:4*e.gridUnit}),type:"error",message:(0,n.tZ)(o.Fragment,null,this.state.errors.map((e=>(0,n.tZ)("div",{key:e},e))))}):null}renderMetricCollection(){const{datasource:e}=this.state,{metrics:t}=e,a=null!=t&&t.length?this.sortMetrics(t):[];return(0,n.tZ)(G,{tableColumns:["metric_name","verbose_name","expression"],sortColumns:["metric_name","verbose_name","expression"],columnLabels:{metric_name:(0,f.t)("Metric"),verbose_name:(0,f.t)("Label"),expression:(0,f.t)("SQL expression")},expandFieldset:(0,n.tZ)(ue,null,(0,n.tZ)(F,{compact:!0},(0,n.tZ)(U,{fieldKey:"description",label:(0,f.t)("Description"),control:(0,n.tZ)(N.Z,{controlId:"description",placeholder:(0,f.t)("Description")})}),(0,n.tZ)(U,{fieldKey:"d3format",label:(0,f.t)("D3 format"),control:(0,n.tZ)(N.Z,{controlId:"d3format",placeholder:"%y/%m/%d"})}),(0,n.tZ)(U,{label:(0,f.t)("Certified by"),fieldKey:"certified_by",description:(0,f.t)("Person or group that has certified this metric"),control:(0,n.tZ)(N.Z,{controlId:"certified_by",placeholder:(0,f.t)("Certified by")})}),(0,n.tZ)(U,{label:(0,f.t)("Certification details"),fieldKey:"certification_details",description:(0,f.t)("Details of the certification"),control:(0,n.tZ)(N.Z,{controlId:"certification_details",placeholder:(0,f.t)("Certification details")})}),(0,n.tZ)(U,{label:(0,f.t)("Warning"),fieldKey:"warning_markdown",description:(0,f.t)("Optional warning about use of this metric"),control:(0,n.tZ)(K.Z,{controlId:"warning_markdown",language:"markdown",offerEditInModal:!1})}))),collection:a,allowAddItem:!0,onChange:this.onDatasourcePropChange.bind(this,"metrics"),itemGenerator:()=>({metric_name:"<new metric>",verbose_name:"",expression:""}),itemRenderers:{metric_name:(e,t,a,i)=>(0,n.tZ)(Q,null,i.is_certified&&(0,n.tZ)(S.Z,{certifiedBy:i.certified_by,details:i.certification_details}),i.warning_markdown&&(0,n.tZ)(w.Z,{warningMarkdown:i.warning_markdown}),(0,n.tZ)(I.Z,{canEdit:!0,title:e,onSaveTitle:t})),verbose_name:(e,t)=>(0,n.tZ)(N.Z,{canEdit:!0,value:e,onChange:t}),expression:(e,t)=>(0,n.tZ)(K.Z,{canEdit:!0,initialValue:e,onChange:t,extraClasses:["datasource-sql-expression"],language:"sql",offerEditInModal:!1,minLines:5}),description:(e,t,a)=>(0,n.tZ)(he,{label:a,formElement:(0,n.tZ)(N.Z,{value:e,onChange:t})}),d3format:(e,t,a)=>(0,n.tZ)(he,{label:a,formElement:(0,n.tZ)(N.Z,{value:e,onChange:t})})},allowDeletes:!0,stickyHeader:!0})}render(){const{datasource:e,activeTabKey:t}=this.state,{metrics:a}=e,i=null!=a&&a.length?this.sortMetrics(a):[],{theme:s}=this.props;return(0,n.tZ)(W,null,this.renderErrors(),(0,n.tZ)(u.Z,{css:e=>({marginBottom:4*e.gridUnit}),type:"warning",message:(0,n.tZ)(o.Fragment,null," ",(0,n.tZ)("strong",null,(0,f.t)("Be careful.")," "),(0,f.t)("Changing these settings will affect all charts using this dataset, including charts owned by other people."))}),(0,n.tZ)(V,{fullWidth:!1,id:"table-tabs",onChange:this.handleTabSelect,defaultActiveKey:t},(0,n.tZ)(x.ZP.TabPane,{key:0,tab:(0,f.t)("Source")},this.renderSourceFieldset(s)),(0,n.tZ)(x.ZP.TabPane,{tab:(0,n.tZ)(de,{collection:i,title:(0,f.t)("Metrics")}),key:1},this.renderMetricCollection()),(0,n.tZ)(x.ZP.TabPane,{tab:(0,n.tZ)(de,{collection:this.state.databaseColumns,title:(0,f.t)("Columns")}),key:2},(0,n.tZ)(ne,null,(0,n.tZ)(te,null,(0,n.tZ)("span",{className:"m-t-10 m-r-10"},(0,n.tZ)(_.Z,{buttonSize:"small",buttonStyle:"tertiary",onClick:this.syncMetadata,className:"sync-from-source",disabled:this.state.isEditMode},(0,n.tZ)("i",{className:"fa fa-database"})," ",(0,f.t)("Sync columns from source")))),(0,n.tZ)(ce,{className:"columns-table",columns:this.state.databaseColumns,datasource:e,onColumnsChange:e=>this.setColumns({databaseColumns:e}),onDatasourceChange:this.onDatasourceChange}),this.state.metadataLoading&&(0,n.tZ)(D.Z,null))),(0,n.tZ)(x.ZP.TabPane,{tab:(0,n.tZ)(de,{collection:this.state.calculatedColumns,title:(0,f.t)("Calculated columns")}),key:3},(0,n.tZ)(ne,null,(0,n.tZ)(ce,{columns:this.state.calculatedColumns,onColumnsChange:e=>this.setColumns({calculatedColumns:e}),onDatasourceChange:this.onDatasourceChange,datasource:e,editableColumnName:!0,showExpression:!0,allowAddItem:!0,allowEditDataType:!0,itemGenerator:()=>({column_name:"<new column>",filterable:!0,groupby:!0,expression:"<enter SQL expression here>",__expanded:!0})}))),(0,n.tZ)(x.ZP.TabPane,{key:4,tab:(0,f.t)("Settings")},(0,n.tZ)(d.X2,{gutter:16},(0,n.tZ)(d.JX,{xs:24,md:12},(0,n.tZ)(ue,null,this.renderSettingsFieldset())),(0,n.tZ)(d.JX,{xs:24,md:12},(0,n.tZ)(ue,null,this.renderAdvancedFieldset()))))))}}fe.defaultProps={onChange:()=>{}},fe.propTypes=me;const Ze=(0,y.b)(fe),ye=(0,X.Z)(Ze)},79789:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(67294),i=a(61988),s=a(51995),o=a(70163),l=a(58593),r=a(11965);const d=function({certifiedBy:e,details:t,size:a="l"}){return(0,r.tZ)(l.u,{id:"certified-details-tooltip",title:(0,r.tZ)(n.Fragment,null,e&&(0,r.tZ)("div",null,(0,r.tZ)("strong",null,(0,i.t)("Certified by %s",e))),(0,r.tZ)("div",null,t))},(0,r.tZ)(o.Z.Certified,{iconColor:s.K6.colors.primary.base,iconSize:a}))}},73995:(e,t,a)=>{a.d(t,{Z:()=>Z});var n=a(67294),i=a(51995),s=a(31069),o=a(61988),l=a(15926),r=a.n(l),d=a(4715),c=a(37921),h=a(49238),u=a(40277),m=a(14114),p=a(11965);const g=i.iK.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.gridUnit}px;\n      margin-top: ${5*e.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .select {\n      width: calc(100% - 30px - ${e.gridUnit}px);\n      flex: 1;\n    }\n\n    & > div {\n      margin-bottom: ${4*e.gridUnit}px;\n    }\n  `}
`,b=i.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-left: ${({theme:e})=>e.gridUnit-2}px;

  .backend {
    overflow: visible;
  }

  .name {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,f=({backend:e,databaseName:t})=>(0,p.tZ)(b,null,(0,p.tZ)(c.Z,{className:"backend"},e),(0,p.tZ)("span",{className:"name",title:t},t));function Z({db:e,formMode:t=!1,getDbList:a,handleError:i,isDatabaseSelectEnabled:l=!0,onDbChange:c,onSchemaChange:b,onSchemasLoad:Z,readOnly:y=!1,schema:C,sqlLabMode:v=!1}){const[_,x]=(0,n.useState)(!1),[S,w]=(0,n.useState)([]),[k,E]=(0,n.useState)(e?{label:(0,p.tZ)(f,{backend:e.backend,databaseName:e.database_name}),value:e.id,...e}:void 0),[D,T]=(0,n.useState)(C?{label:C,value:C}:void 0),[I,M]=(0,n.useState)(0),{addSuccessToast:L}=(0,m.e)(),N=(0,n.useMemo)((()=>async(e,n,l)=>{const d=`/api/v1/database/?q=${r().encode({order_columns:"database_name",order_direction:"asc",page:n,page_size:l,...t||!v?{filters:[{col:"database_name",opr:"ct",value:e}]}:{filters:[{col:"database_name",opr:"ct",value:e},{col:"expose_in_sqllab",opr:"eq",value:!0}]}})}`;return s.Z.get({endpoint:d}).then((({json:e})=>{const{result:t}=e;a&&a(t),0===t.length&&i((0,o.t)("It seems you don't have access to any database"));const n=t.map((e=>({label:(0,p.tZ)(f,{backend:e.backend,databaseName:e.database_name}),value:e.id,id:e.id,database_name:e.database_name,backend:e.backend,allow_multi_schema_metadata_fetch:e.allow_multi_schema_metadata_fetch})));return{data:n,totalCount:n.length}}))}),[t,a,i,v]);function K(e,t){return(0,p.tZ)("div",{className:"section"},(0,p.tZ)("span",{className:"select"},e),(0,p.tZ)("span",{className:"refresh"},t))}return(0,n.useEffect)((()=>{if(k){x(!0);const e=r().encode({force:I>0}),t=`/api/v1/database/${k.value}/schemas/?q=${e}`;s.Z.get({endpoint:t}).then((({json:e})=>{const t=e.result.map((e=>({value:e,label:e,title:e})));Z&&Z(t),w(t),x(!1),I>0&&L("List refreshed")})).catch((()=>{x(!1),i((0,o.t)("There was an error loading the schemas"))}))}}),[k,Z,I]),(0,p.tZ)(g,null,K((0,p.tZ)(d.P,{ariaLabel:(0,o.t)("Select database or type database name"),optionFilterProps:["database_name","value"],header:(0,p.tZ)(h.lX,null,(0,o.t)("Database")),lazyLoading:!1,onChange:function(e,t){E(t),T(void 0),c&&c(t),b&&b(void 0)},value:k,placeholder:(0,o.t)("Select database or type database name"),disabled:!l||y,options:N}),null),function(){const e=!t&&!y&&(0,p.tZ)(u.Z,{onClick:()=>M(I+1),tooltipContent:(0,o.t)("Force refresh schema list")});return K((0,p.tZ)(d.P,{ariaLabel:(0,o.t)("Select schema or type schema name"),disabled:y,header:(0,p.tZ)(h.lX,null,(0,o.t)("Schema")),labelInValue:!0,lazyLoading:!1,loading:_,name:"select-schema",placeholder:(0,o.t)("Select schema or type schema name"),onChange:e=>function(e){T(e),b&&b(e.value)}(e),options:S,showSearch:!0,value:D}),e)}())}},38270:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(67294),i=a(94184),s=a.n(i),o=a(51995),l=a(61988),r=a(58593),d=a(79789),c=a(11965);const h=(0,o.iK)(d.Z)`
  vertical-align: middle;
`;function u({canEdit:e=!1,editing:t=!1,extraClasses:a,multiLine:i=!1,noPermitTooltip:o,onSaveTitle:d,showTooltip:u=!0,style:m,title:p="",defaultTitle:g="",placeholder:b="",certifiedBy:f,certificationDetails:Z}){const[y,C]=(0,n.useState)(t),[v,_]=(0,n.useState)(p),[x,S]=(0,n.useState)(p),[w,k]=(0,n.useState)(null),E=(0,n.useRef)();function D(){if(!e||y)return;const t=E.current?E.current.getBoundingClientRect():null;C(!0),k(t)}function T(){const t=v.trim();e&&(C(!1),t.length?(x!==t&&S(t),p!==t&&d(t)):_(x))}function I(e){" "===e.key&&e.stopPropagation(),"Enter"===e.key&&(e.preventDefault(),T())}function M(t){e&&_(t.target.value)}function L(e){"Enter"===e.key&&(e.preventDefault(),T())}let N;(0,n.useEffect)((()=>{p!==v&&(S(v),_(p))}),[p]),(0,n.useEffect)((()=>{if(y&&(E.current.focus(),E.current.setSelectionRange)){const{length:e}=E.current.value;E.current.setSelectionRange(e,e),E.current.scrollLeft=E.current.scrollWidth,E.current.scrollTop=E.current.scrollHeight}}),[y]),N=v,y||v||(N=g||p);const K=y&&w?{height:`${w.height}px`}:void 0;let A=i&&y?(0,c.tZ)("textarea",{ref:E,value:N,className:p?void 0:"text-muted",onKeyDown:I,onChange:M,onBlur:T,onClick:D,onKeyPress:L,placeholder:b,style:K}):(0,c.tZ)("input",{ref:E,type:y?"text":"button",value:N,className:p?void 0:"text-muted",onKeyDown:I,onChange:M,onBlur:T,onClick:D,onKeyPress:L,placeholder:b});return u&&!y&&(A=(0,c.tZ)(r.u,{id:"title-tooltip",title:e?(0,l.t)("Click to edit"):o||(0,l.t)("You don't have the rights to alter this title.")},A)),e||(A=(0,c.tZ)("span",{title:N},N)),(0,c.tZ)("span",{className:s()("editable-title",a,e&&"editable-title--editable",y&&"editable-title--editing"),style:m},f&&(0,c.tZ)(n.Fragment,null,(0,c.tZ)(h,{certifiedBy:f,details:Z,size:"xl"})," "),A)}},40277:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(67294),i=a(58593),s=a(70163),o=a(11965);const l=({onClick:e,tooltipContent:t})=>{const a=(0,n.forwardRef)(((e,t)=>(0,o.tZ)(s.Z.Refresh,e)));return(0,o.tZ)(i.u,{title:t},(0,o.tZ)(a,{role:"button",onClick:e,css:e=>({cursor:"pointer",color:e.colors.grayscale.base,"&:hover":{color:e.colors.primary.base}})}))}},17982:(e,t,a)=>{a.d(t,{Z:()=>y});var n=a(67294),i=a(51995),s=a(31069),o=a(61988),l=a(4715),r=a(49238),d=a(70163),c=a(73995),h=a(40277),u=a(79789),m=a(86057),p=a(14114),g=a(11965);const b=i.iK.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.gridUnit}px;\n      margin-top: ${5*e.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .divider {\n      border-bottom: 1px solid ${e.colors.secondary.light5};\n      margin: 15px 0;\n    }\n\n    .table-length {\n      color: ${e.colors.grayscale.light1};\n    }\n\n    .select {\n      flex: 1;\n    }\n  `}
`,f=i.iK.span`
  align-items: center;
  display: flex;
  white-space: nowrap;

  svg,
  small {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,Z=({table:e})=>{const{label:t,type:a,extra:n}=e;return(0,g.tZ)(f,{title:t},"view"===a?(0,g.tZ)(d.Z.Eye,{iconSize:"m"}):(0,g.tZ)(d.Z.Table,{iconSize:"m"}),(null==n?void 0:n.certification)&&(0,g.tZ)(u.Z,{certifiedBy:n.certification.certified_by,details:n.certification.details,size:"l"}),(null==n?void 0:n.warning_markdown)&&(0,g.tZ)(m.Z,{warningMarkdown:n.warning_markdown,size:"l"}),t)},y=({database:e,formMode:t=!1,getDbList:a,handleError:i,isDatabaseSelectEnabled:d=!0,onDbChange:u,onSchemaChange:m,onSchemasLoad:f,onTableChange:y,onTablesLoad:C,readOnly:v=!1,schema:_,sqlLabMode:x=!0,tableName:S})=>{const[w,k]=(0,n.useState)(e),[E,D]=(0,n.useState)(_),[T,I]=(0,n.useState)(),[M,L]=(0,n.useState)(0),[N,K]=(0,n.useState)(0),[A,P]=(0,n.useState)(!1),[$,q]=(0,n.useState)([]),{addSuccessToast:R}=(0,p.e)();(0,n.useEffect)((()=>{void 0===e&&(k(void 0),D(void 0),I(void 0))}),[e]),(0,n.useEffect)((()=>{if(w&&E){P(!0);const e=encodeURIComponent(E),t=M!==N,a=encodeURI(`/superset/tables/${w.id}/${e}/undefined/${t}/`);N!==M&&K(M),s.Z.get({endpoint:a}).then((({json:e})=>{const a=[];let n;e.options.forEach((e=>{const t={value:e.value,label:(0,g.tZ)(Z,{table:e}),text:e.label};a.push(t),e.label===S&&(n=t)})),C&&C(e.options),q(a),I(n),P(!1),t&&R("List updated")})).catch((e=>{P(!1),i((0,o.t)("There was an error loading the tables"))}))}}),[w,E,C,M]);const U=e=>{I(e),y&&E&&y(null==e?void 0:e.value,E)},F=(0,n.useMemo)((()=>(e,t)=>{const a=e.trim().toLowerCase(),{text:n}=t;return n.toLowerCase().includes(a)}),[]);return(0,g.tZ)(b,null,(0,g.tZ)(c.Z,{key:null==w?void 0:w.id,db:w,formMode:t,getDbList:a,handleError:i,onDbChange:v?void 0:e=>{k(e),u&&u(e)},onSchemaChange:v?void 0:e=>{D(e),m&&m(e),U(void 0)},onSchemasLoad:f,schema:E,sqlLabMode:x,isDatabaseSelectEnabled:d&&!v,readOnly:v}),x&&!t&&(0,g.tZ)("div",{className:"divider"}),function(){const a=E&&!t&&v||!E&&!(null!=e&&e.allow_multi_schema_metadata_fetch),n=x?(0,g.tZ)(r.lX,null,(0,o.t)("See table schema")):(0,g.tZ)(r.lX,null,(0,o.t)("Table"));return i=(0,g.tZ)(l.P,{ariaLabel:(0,o.t)("Select table or type table name"),disabled:a,filterOption:F,header:n,labelInValue:!0,lazyLoading:!1,loading:A,name:"select-table",onChange:e=>U(e),options:$,placeholder:(0,o.t)("Select table or type table name"),showSearch:!0,value:T}),s=!t&&!v&&(0,g.tZ)(h.Z,{onClick:()=>L(M+1),tooltipContent:(0,o.t)("Force refresh table list")}),(0,g.tZ)("div",{className:"section"},(0,g.tZ)("span",{className:"select"},i),(0,g.tZ)("span",{className:"refresh"},s));var i,s}())}}}]);