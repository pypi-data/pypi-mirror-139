"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[818],{51127:e=>{var t=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,a){var l,s,o;return a=a||{},l=JSON.stringify([1],void 0,void 0===a.indent?2:a.indent).slice(2,-3),s=""===l?1/0:void 0===a.maxLength?80:a.maxLength,o=a.replacer,function e(a,r,n){var i,d,c,h,u,m,p,b,g,Z,f,y;if(a&&"function"==typeof a.toJSON&&(a=a.toJSON()),void 0===(f=JSON.stringify(a,o)))return f;if(p=s-r.length-n,f.length<=p&&(g=f.replace(t,(function(e,t){return t||e+" "}))).length<=p)return g;if(null!=o&&(a=JSON.parse(f),o=void 0),"object"==typeof a&&null!==a){if(b=r+l,c=[],d=0,Array.isArray(a))for(Z="[",i="]",p=a.length;d<p;d++)c.push(e(a[d],b,d===p-1?0:1)||"null");else for(Z="{",i="}",p=(m=Object.keys(a)).length;d<p;d++)h=m[d],u=JSON.stringify(h)+": ",void 0!==(y=e(a[h],b,u.length+(d===p-1?0:1)))&&c.push(u+y);if(c.length>0)return[Z,l+c.join(",\n"+b),i].join("\n"+r)}return f}(e,"",0)}},20818:(e,t,a)=>{a.d(t,{Z:()=>j});var l=a(67294),s=a(82191),o=a(49238),r=a(51127),n=a.n(r),i=a(35932),d=a(4715),c=a(15926),h=a.n(c),u=a(51995),m=a(61988),p=a(31069),b=a(55786),g=a(81545),Z=a(74069),f=a(94670),y=a(45697),v=a.n(y),C=a(95470),S=a(11965);const w={onChange:v().func,labelMargin:v().number,colorScheme:v().string,hasCustomLabelColors:v().bool};class x extends l.PureComponent{constructor(e){super(e),this.state={hovered:!1},this.categoricalSchemeRegistry=(0,g.Z)(),this.choices=this.categoricalSchemeRegistry.keys().map((e=>[e,e])),this.schemes=this.categoricalSchemeRegistry.getMap()}setHover(e){this.setState({hovered:e})}render(){const{colorScheme:e,labelMargin:t=0,hasCustomLabelColors:a}=this.props;return(0,S.tZ)(C.Z,{description:(0,m.t)("Any color palette selected here will override the colors applied to this dashboard's individual charts"),labelMargin:t,name:"color_scheme",onChange:this.props.onChange,value:e,choices:this.choices,clearable:!0,schemes:this.schemes,hovered:this.state.hovered,hasCustomLabelColors:a})}}x.propTypes=w,x.defaultProps={hasCustomLabelColors:!1,colorScheme:void 0,onChange:()=>{}};const _=x;var k=a(98286),J=a(14114),N=a(91877),O=a(93185);const X=(0,u.iK)(o.xJ)`
  margin-bottom: 0;
`,A=(0,u.iK)(f.Ad)`
  border-radius: ${({theme:e})=>e.borderRadius}px;
  border: 1px solid ${({theme:e})=>e.colors.secondary.light2};
`,j=(0,J.Z)((({addSuccessToast:e,colorScheme:t,dashboardId:a,dashboardInfo:r,dashboardTitle:c,onHide:u=(()=>{}),onlyApply:y=!1,onSubmit:v=(()=>{}),show:C=!1})=>{const[w]=s.l0.useForm(),[x,J]=(0,l.useState)(!1),[j,T]=(0,l.useState)(!1),[L,I]=(0,l.useState)(t),[R,B]=(0,l.useState)(""),[D,F]=(0,l.useState)(),[M,$]=(0,l.useState)([]),[P,E]=(0,l.useState)([]),H=y?(0,m.t)("Apply"):(0,m.t)("Save"),z=async e=>{const{error:t,statusText:a,message:l}=await(0,k.O)(e);let s=t||a||(0,m.t)("An error has occurred");"object"==typeof l&&"json_metadata"in l?s=l.json_metadata:"string"==typeof l&&(s=l,"Forbidden"===l&&(s=(0,m.t)("You do not have permission to edit this dashboard"))),Z.Z.error({title:"Error",content:s,okButtonProps:{danger:!0,className:"btn-danger"}})},V=(0,l.useCallback)(((e="owners",t="",a,l)=>{const s=h().encode({filter:t,page:a,page_size:l});return p.Z.get({endpoint:`/api/v1/dashboard/related/${e}?q=${s}`}).then((e=>({data:e.json.result.map((e=>({value:e.value,label:e.text}))),totalCount:e.json.count})))}),[]),q=(0,l.useCallback)((e=>{const{id:t,dashboard_title:a,slug:l,certified_by:s,certification_details:o,owners:r,roles:i,metadata:d}=e,c={id:t,title:a,slug:l||"",certifiedBy:s||"",certificationDetails:o||""};w.setFieldsValue(c),F(c),$(r),E(i),I(d.color_scheme),null!=d&&d.positions&&delete d.positions,B(d?n()(d):"")}),[w]),K=(0,l.useCallback)((()=>{J(!0),p.Z.get({endpoint:`/api/v1/dashboard/${a}`}).then((e=>{var t;const a=e.json.result,l=null!=(t=a.json_metadata)&&t.length?JSON.parse(a.json_metadata):{};q({...a,metadata:l}),J(!1)}),z)}),[a,q]),U=()=>{try{return null!=R&&R.length?JSON.parse(R):{}}catch(e){return{}}},G=e=>{const t=(0,b.Z)(e).map((e=>({id:e.value,full_name:e.label})));$(t)},W=e=>{const t=(0,b.Z)(e).map((e=>({id:e.value,name:e.label})));E(t)},Y=()=>(M||[]).map((e=>({value:e.id,label:e.full_name||`${e.first_name} ${e.last_name}`}))),Q=(e,{updateMetadata:t=!0}={})=>{const a=(0,g.Z)().keys(),l=U();if(e&&!a.includes(e))throw Z.Z.error({title:"Error",content:(0,m.t)("A valid color scheme is required"),okButtonProps:{danger:!0,className:"btn-danger"}}),new Error("A valid color scheme is required");t&&(l.color_scheme=e,l.label_colors=l.label_colors||{},B(n()(l))),I(e)};return(0,l.useEffect)((()=>{C&&(r?q(r):K()),f.Ad.preload()}),[r,K,q,C]),(0,l.useEffect)((()=>{c&&D&&D.title!==c&&w.setFieldsValue({...D,title:c})}),[D,c,w]),(0,S.tZ)(Z.Z,{show:C,onHide:u,title:(0,m.t)("Dashboard properties"),footer:(0,S.tZ)(l.Fragment,null,(0,S.tZ)(i.Z,{htmlType:"button",buttonSize:"small",onClick:u,cta:!0},(0,m.t)("Cancel")),(0,S.tZ)(i.Z,{onClick:w.submit,buttonSize:"small",buttonStyle:"primary",className:"m-r-5",cta:!0},H)),responsive:!0},(0,S.tZ)(s.l0,{form:w,onFinish:()=>{const{title:t,slug:l,certifiedBy:s,certificationDetails:o}=w.getFieldsValue();let r=L,n="";if(null!=R&&R.length){const e=JSON.parse(R);r=(null==e?void 0:e.color_scheme)||L,n=(null==e?void 0:e.color_namespace)||""}Q(r,{updateMetadata:!1});const i={},d={};(0,N.cr)(O.T.DASHBOARD_RBAC)&&(i.roles=P,d.roles=(P||[]).map((e=>e.id)));const c={id:a,title:t,slug:l,jsonMetadata:R,owners:M,colorScheme:r,colorNamespace:n,certifiedBy:s,certificationDetails:o,...i};y?(e((0,m.t)("Dashboard properties updated")),v(c),u()):p.Z.put({endpoint:`/api/v1/dashboard/${a}`,headers:{"Content-Type":"application/json"},body:JSON.stringify({dashboard_title:t,slug:l||null,json_metadata:R||null,owners:(M||[]).map((e=>e.id)),certified_by:s||null,certification_details:s&&o?o:null,...d})}).then((()=>{e((0,m.t)("The dashboard has been saved")),v(c),u()}),z)},layout:"vertical",initialValues:D},(0,S.tZ)(s.X2,null,(0,S.tZ)(s.JX,{xs:24,md:24},(0,S.tZ)("h3",null,(0,m.t)("Basic information")))),(0,S.tZ)(s.X2,{gutter:16},(0,S.tZ)(s.JX,{xs:24,md:12},(0,S.tZ)(o.xJ,{label:(0,m.t)("Title"),name:"title"},(0,S.tZ)(s.II,{type:"text",disabled:x}))),(0,S.tZ)(s.JX,{xs:24,md:12},(0,S.tZ)(X,{label:(0,m.t)("URL slug"),name:"slug"},(0,S.tZ)(s.II,{type:"text",disabled:x})),(0,S.tZ)("p",{className:"help-block"},(0,m.t)("A readable URL for your dashboard")))),(0,N.cr)(O.T.DASHBOARD_RBAC)?(()=>{const e=U(),t=!!Object.keys((null==e?void 0:e.label_colors)||{}).length;return(0,S.tZ)(l.Fragment,null,(0,S.tZ)(s.X2,null,(0,S.tZ)(s.JX,{xs:24,md:24},(0,S.tZ)("h3",{style:{marginTop:"1em"}},(0,m.t)("Access")))),(0,S.tZ)(s.X2,{gutter:16},(0,S.tZ)(s.JX,{xs:24,md:12},(0,S.tZ)(X,{label:(0,m.t)("Owners")},(0,S.tZ)(d.P,{allowClear:!0,ariaLabel:(0,m.t)("Owners"),disabled:x,mode:"multiple",onChange:G,options:(e,t,a)=>V("owners",e,t,a),value:Y()})),(0,S.tZ)("p",{className:"help-block"},(0,m.t)("Owners is a list of users who can alter the dashboard. Searchable by name or username."))),(0,S.tZ)(s.JX,{xs:24,md:12},(0,S.tZ)(X,{label:(0,m.t)("Roles")},(0,S.tZ)(d.P,{allowClear:!0,ariaLabel:(0,m.t)("Roles"),disabled:x,mode:"multiple",onChange:W,options:(e,t,a)=>V("roles",e,t,a),value:(P||[]).map((e=>({value:e.id,label:`${e.name}`})))})),(0,S.tZ)("p",{className:"help-block"},(0,m.t)("Roles is a list which defines access to the dashboard. Granting a role access to a dashboard will bypass dataset level checks. If no roles are defined, then the dashboard is available to all roles.")))),(0,S.tZ)(s.X2,null,(0,S.tZ)(s.JX,{xs:24,md:12},(0,S.tZ)(_,{hasCustomLabelColors:t,onChange:Q,colorScheme:L,labelMargin:4}))))})():(()=>{const e=U(),t=!!Object.keys((null==e?void 0:e.label_colors)||{}).length;return(0,S.tZ)(s.X2,{gutter:16},(0,S.tZ)(s.JX,{xs:24,md:12},(0,S.tZ)("h3",{style:{marginTop:"1em"}},(0,m.t)("Access")),(0,S.tZ)(X,{label:(0,m.t)("Owners")},(0,S.tZ)(d.P,{allowClear:!0,ariaLabel:(0,m.t)("Owners"),disabled:x,mode:"multiple",onChange:G,options:(e,t,a)=>V("owners",e,t,a),value:Y()})),(0,S.tZ)("p",{className:"help-block"},(0,m.t)("Owners is a list of users who can alter the dashboard. Searchable by name or username."))),(0,S.tZ)(s.JX,{xs:24,md:12},(0,S.tZ)("h3",{style:{marginTop:"1em"}},(0,m.t)("Colors")),(0,S.tZ)(_,{hasCustomLabelColors:t,onChange:Q,colorScheme:L,labelMargin:4})))})(),(0,S.tZ)(s.X2,null,(0,S.tZ)(s.JX,{xs:24,md:24},(0,S.tZ)("h3",null,(0,m.t)("Certification")))),(0,S.tZ)(s.X2,{gutter:16},(0,S.tZ)(s.JX,{xs:24,md:12},(0,S.tZ)(X,{label:(0,m.t)("Certified by"),name:"certifiedBy"},(0,S.tZ)(s.II,{type:"text",disabled:x})),(0,S.tZ)("p",{className:"help-block"},(0,m.t)("Person or group that has certified this dashboard."))),(0,S.tZ)(s.JX,{xs:24,md:12},(0,S.tZ)(X,{label:(0,m.t)("Certification details"),name:"certificationDetails"},(0,S.tZ)(s.II,{type:"text",disabled:x})),(0,S.tZ)("p",{className:"help-block"},(0,m.t)("Any additional detail to show in the certification tooltip.")))),(0,S.tZ)(s.X2,null,(0,S.tZ)(s.JX,{xs:24,md:24},(0,S.tZ)("h3",{style:{marginTop:"1em"}},(0,S.tZ)(i.Z,{buttonStyle:"link",onClick:()=>T(!j)},(0,S.tZ)("i",{className:"fa fa-angle-"+(j?"down":"right"),style:{minWidth:"1em"}}),(0,m.t)("Advanced"))),j&&(0,S.tZ)(l.Fragment,null,(0,S.tZ)(X,{label:(0,m.t)("JSON metadata")},(0,S.tZ)(A,{showLoadingForImport:!0,name:"json_metadata",value:R,onChange:B,tabSize:2,width:"100%",height:"200px",wrapEnabled:!0})),(0,S.tZ)("p",{className:"help-block"},(0,m.t)("This JSON object is generated dynamically when clicking the save or overwrite button in the dashboard view. It is exposed here for reference and for power users who may want to alter specific parameters.")))))))}))}}]);